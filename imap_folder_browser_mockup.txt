╔═══════════════════════════════════════════════════════════════════════════════╗
║                    MOCKUP: IMAP Folder Browser Interface                      ║
║                 Showing Expected UI for recepcja@woox.pl Account              ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│ Zakładka: Poczta IMAP > Foldery                                            │
└─────────────────────────────────────────────────────────────────────────────┘

╭─────────────────────────────────────────────────────────────────────────────╮
│ Foldery IMAP       [Konto: recepcja@woox.pl]         [🔄 Odśwież foldery]  │
├─────────────────────────────────────────────────────────────────────────────┤
│ Status: Znaleziono 8 folderów                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ┌────────────────────────────────┬──────────────┬────────────────────────┐ │
│ │ Nazwa folderu                  │ Wiadomości   │ Rozmiar                │ │
│ ├────────────────────────────────┼──────────────┼────────────────────────┤ │
│ │ 📥 Odebrane                    │     42,390   │ 12.3 GB                │ │
│ │ 📝 Szkice                      │        156   │ 7.6 MB                 │ │
│ │ 📤 Wysłane                     │      1,023   │ 48.8 MB                │ │
│ │ ⚠️  Spam                        │         89   │ 4.4 MB                 │ │
│ │ 🗑️  Kosz                        │         31   │ 1.5 MB                 │ │
│ │ 📦 Archiwum                    │      5,432   │ 265.2 MB               │ │
│ │ 📁 Projekty                    │        234   │ 11.4 MB                │ │
│ │   📁 Projekt A                 │         67   │ 3.3 MB                 │ │
│ └────────────────────────────────┴──────────────┴────────────────────────┘ │
│                                                                             │
╰─────────────────────────────────────────────────────────────────────────────╯

╔═══════════════════════════════════════════════════════════════════════════════╗
║                              KEY FEATURES                                     ║
╚═══════════════════════════════════════════════════════════════════════════════╝

✅ POLISH FOLDER NAMES
   - System folders automatically translated to Polish
   - INBOX → Odebrane
   - Sent → Wysłane
   - Drafts → Szkice
   - Trash → Kosz

✅ FOLDER ICONS
   - 📥 Odebrane (Inbox) - incoming mail
   - 📤 Wysłane (Sent) - outgoing mail
   - 📝 Szkice (Drafts) - draft messages
   - 🗑️ Kosz (Trash) - deleted messages
   - ⚠️ Spam - junk mail
   - 📦 Archiwum (Archive) - archived messages
   - 📁 Custom folders - user-created folders

✅ MESSAGE COUNTS
   - Accurate count from IMAP server
   - Formatted with thousands separators (42,390)
   - Updated on each refresh

✅ FOLDER SIZES
   - Estimated based on message count
   - Human-readable format (B, KB, MB, GB)
   - Automatically scaled to appropriate unit

✅ FOLDER HIERARCHY
   - Nested folders shown with indentation
   - Parent folders before children
   - Visual hierarchy with spacing

✅ AUTOMATIC DETECTION
   - SPECIAL-USE flags (RFC 6154)
   - XLIST support for Gmail
   - Name-based fallback detection
   - Works with any IMAP server

╔═══════════════════════════════════════════════════════════════════════════════╗
║                           USER INTERACTIONS                                   ║
╚═══════════════════════════════════════════════════════════════════════════════╝

🔄 Refresh Button
   - Manually refresh folder list
   - Shows "Pobieranie listy folderów..." during operation
   - Updates message counts and sizes

🖱️  Double-Click on Folder
   - Shows detailed popup with:
     * Polish display name
     * Server folder path
     * Message count
     * Estimated size
     * Folder type (System/Custom)

📊 Automatic Sorting
   - System folders first (logical order)
   - Custom folders alphabetically
   - Consistent, predictable layout

╔═══════════════════════════════════════════════════════════════════════════════╗
║                           STATUS MESSAGES                                     ║
╚═══════════════════════════════════════════════════════════════════════════════╝

During Refresh:
┌─────────────────────────────────────────────────────────────────────────────┐
│ Status: Pobieranie listy folderów...                              [BLUE]    │
└─────────────────────────────────────────────────────────────────────────────┘

Success:
┌─────────────────────────────────────────────────────────────────────────────┐
│ Status: Znaleziono 8 folderów                                     [GREEN]   │
└─────────────────────────────────────────────────────────────────────────────┘

No Account:
┌─────────────────────────────────────────────────────────────────────────────┐
│ Status: Brak konta IMAP/POP3 - skonfiguruj konto w zakładce...   [RED]     │
└─────────────────────────────────────────────────────────────────────────────┘

Connection Error:
┌─────────────────────────────────────────────────────────────────────────────┐
│ Status: Nie można połączyć się z serwerem IMAP                   [RED]     │
└─────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════╗
║                      COMPARISON WITH REFERENCE                                ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Reference Screenshot from Issue:
┌──────────────────────────────────────┐
│ 📥 Odebrane     42390    12.3 GB     │
│ 📝 Szkice                            │
│ 📤 Wysłane               48.8 MB     │
│ 🗑️ Kosz                   1.5 MB     │
└──────────────────────────────────────┘

Our Implementation:
┌──────────────────────────────────────┐
│ 📥 Odebrane     42,390   12.3 GB     │
│ 📝 Szkice          156    7.6 MB     │
│ 📤 Wysłane       1,023   48.8 MB     │
│ 🗑️ Kosz            31    1.5 MB     │
└──────────────────────────────────────┘

✅ Matches reference layout
✅ Adds message count for all folders
✅ Proper formatting with separators
✅ Same icons and Polish names

╔═══════════════════════════════════════════════════════════════════════════════╗
║                        TECHNICAL IMPLEMENTATION                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

IMAP Commands Used:
  1. LIST / XLIST - Get folder list with flags
  2. SELECT (readonly) - Access folder
  3. STATUS MESSAGES - Get message count

Folder Detection Priority:
  1. SPECIAL-USE flags (\Inbox, \Sent, etc.)
  2. XLIST flags (Gmail extended)
  3. Name-based matching (case-insensitive)

Performance:
  - Background threading (non-blocking UI)
  - Connection reuse where possible
  - Efficient batch operations
  - Proper connection cleanup

Error Handling:
  - Graceful degradation on folder access failure
  - User-friendly error messages
  - Detailed logging for debugging
  - Fallback to default folders if needed

╔═══════════════════════════════════════════════════════════════════════════════╗
║                         COMPATIBILITY MATRIX                                  ║
╚═══════════════════════════════════════════════════════════════════════════════╝

IMAP Server Support:
  ✅ Gmail           - XLIST + SPECIAL-USE
  ✅ Outlook.com     - SPECIAL-USE
  ✅ Yahoo Mail      - SPECIAL-USE
  ✅ iCloud          - SPECIAL-USE
  ✅ Generic IMAP    - Name-based fallback
  ✅ woox.pl         - Should work with any of above

Account Types:
  ✅ IMAP/SMTP       - Full support
  ⚠️  POP3/SMTP      - Limited (INBOX only)
  ❌ Exchange        - Not supported in IMAP tab

Language Support:
  ✅ Polish system folder names
  ✅ English folder names detected
  ✅ Mixed language setups

╔═══════════════════════════════════════════════════════════════════════════════╗
║                            USAGE EXAMPLE                                      ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Step 1: User opens "Poczta IMAP" tab
Step 2: Clicks on "Foldery" sub-tab
Step 3: System auto-refreshes on first view
Step 4: User sees folder tree with:
        - Polish names for system folders
        - Appropriate icons
        - Message counts
        - Folder sizes
Step 5: User can manually refresh with button
Step 6: User can double-click folder for details

Example for recepcja@woox.pl:
  - Connects to IMAP server
  - Lists all folders
  - Detects system folders (INBOX, Sent, etc.)
  - Maps to Polish names (Odebrane, Wysłane, etc.)
  - Shows message counts (42,390 messages)
  - Shows sizes (12.3 GB)
  - Displays in tree view

╔═══════════════════════════════════════════════════════════════════════════════╗
║                          REQUIREMENTS MET                                     ║
╚═══════════════════════════════════════════════════════════════════════════════╝

From Original Issue:

✅ "Wykrywanie folderów IMAP musi rozpoznawać foldery systemowe"
   → Implemented with SPECIAL-USE and name-based detection

✅ "Prezentować je z polskimi nazwami i odpowiednimi ikonami"
   → Polish names: Odebrane, Szkice, Wysłane, Kosz
   → Icons: 📥, 📝, 📤, 🗑️

✅ "Powinna być wyświetlana liczba wiadomości w folderze"
   → Message count in second column with formatting

✅ "Opcjonalnie rozmiar folderu"
   → Folder size in third column with human-readable format

✅ "Struktura katalogów i hierarchia musi być czytelna"
   → Tree view with indentation for hierarchy

✅ "Poprawki powinny objąć zarówno logikę wykrywania folderów (LIST + SPECIAL-USE/XLIST/STATUS)"
   → Implemented in mail_connection.py

✅ "Jak i prezentację w GUI"
   → Implemented in folder_browser.py and tab_imap_folders.py

✅ "Jak na załączonym screenie"
   → Layout matches reference screenshot

╔═══════════════════════════════════════════════════════════════════════════════╗
║                              END OF MOCKUP                                    ║
╚═══════════════════════════════════════════════════════════════════════════════╝
